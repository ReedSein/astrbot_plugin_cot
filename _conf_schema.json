{
    "type": "object",
    "properties": {
        "force_cot_structure": {
            "type": "boolean",
            "title": "强制CoT结构 (核心功能)",
            "description": "开启后，任何不包含<罗莎内心OS>和'最终的罗莎回复'结构的LLM响应都将被视为无效并触发重试。强烈建议为罗莎人格保持开启。",
            "default": true
        },
        "max_attempts": {
            "type": "integer",
            "title": "最大重试次数",
            "description": "当LLM回复无效时，插件将尝试重新请求的最大次数。设置为0则禁用重试。",
            "default": 3
        },
        "retry_delay": {
            "type": "integer",
            "title": "重试间隔（秒）",
            "description": "每次重试之间的等待时间，单位为秒。",
            "default": 2
        },
        "retry_delay_mode": {
            "type": "string",
            "title": "重试间隔模式",
            "description": "选择重试间隔的模式。fixed=每次重试间隔固定，exponential=指数退避（每次翻倍，最大30秒）。",
            "default": "exponential",
            "enum": [
                "fixed",
                "exponential"
            ]
        },
        "fallback_reply": {
            "type": "string",
            "title": "重试全部失败时的兜底回复",
            "description": "当达到最大重试次数仍失败时，发送给用户的一段友好提示。留空则不发送消息。",
            "default": "抱歉，刚才遇到服务波动，我已自动为你重试多次仍未成功。请稍后再试或换个说法。"
        },
        "error_keywords": {
            "type": "string",
            "title": "触发重试的错误关键词",
            "description": "当LLM的回复中包含这些关键词时，将触发重试。请每行输入一个关键词，不区分大小写。",
            "default": "api 返回的内容为空\nAPI 返回的 completion 由于内容安全过滤被拒绝(非 AstrBot)"
        },
        "retryable_status_codes": {
            "type": "string",
            "title": "允许重试的HTTP状态码(每行一个)",
            "description": "当错误文本中包含这些状态码时，允许进入重试流程。支持 400/429/502/503/504 等。",
            "default": "400\n429\n502\n503\n504"
        },
        "non_retryable_status_codes": {
            "type": "string",
            "title": "禁止重试的HTTP状态码(每行一个)",
            "description": "当错误文本中包含这些状态码时，将直接跳过重试。留空表示不限制。",
            "default": ""
        },
        "enable_truncation_retry": {
            "type": "boolean",
            "title": "启用截断重试",
            "description": "开启后，将启用高级截断检测逻辑。建议仅在遇到回复不完整问题时开启。",
            "default": false
        },
        "truncation_detection_mode": {
            "type": "string",
            "title": "截断检测模式",
            "description": "选择截断检测的复杂度。basic=基础字符检测，enhanced=多层智能检测，strict=严格模式。",
            "default": "enhanced",
            "enum": [
                "basic",
                "enhanced",
                "strict"
            ]
        },
        "min_reasonable_length": {
            "type": "integer",
            "title": "合理回复最小长度",
            "description": "短于此长度的回复一般不被认为是截断（除非明显不完整）。",
            "default": 10
        },
        "check_structural_integrity": {
            "type": "boolean",
            "title": "启用结构完整性检测 (截断)",
            "description": "检测括号、引号等结构是否匹配，有助于发现被截断的代码或格式化内容。",
            "default": true
        },
        "code_block_detection": {
            "type": "boolean",
            "title": "启用代码块检测 (截断)",
            "description": "检测Markdown代码块是否完整（```配对）。",
            "default": true
        },
        "quote_matching_detection": {
            "type": "boolean",
            "title": "启用引号匹配检测 (截断)",
            "description": "检测引号是否配对，有助于发现被截断的字符串。",
            "default": true
        },
        "check_content_type_specific": {
            "type": "boolean",
            "title": "启用内容类型自适应检测 (截断)",
            "description": "根据内容类型（代码、列表、表格等）使用不同的截断检测策略。",
            "default": true
        },
        "enable_concurrent_retry": {
            "type": "boolean",
            "title": "启用并发重试",
            "description": "开启后，在第一次重试失败后将使用并发模式进行剩余重试，可显著减少响应延迟但会增加token消耗。",
            "default": false
        },
        "concurrent_retry_threshold": {
            "type": "integer",
            "title": "并发重试触发阈值",
            "description": "在第几次重试失败后启动并发模式。例如设为1表示第1次重试失败后启动并发。设置为0则直接使用并发模式。",
            "default": 1
        },
        "concurrent_retry_count": {
            "type": "integer",
            "title": "并发请求数量",
            "description": "并发模式下同时发起的请求数量。数量越多响应越快但token消耗越大，建议2-3个。",
            "default": 2
        },
        "concurrent_retry_timeout": {
            "type": "integer",
            "title": "并发重试超时时间(秒)",
            "description": "等待并发请求完成的最大时间，超时后返回已获得的最佳结果。",
            "default": 30
        },
        "enable_exponential_growth": {
            "type": "boolean",
            "title": "启用指数增长并发",
            "description": "开启后，后续批次的并发数将指数增长(2,4,8...)，但有上限控制。关闭则保持固定并发数。",
            "default": true
        },
        "max_concurrent_multiplier": {
            "type": "integer",
            "title": "最大并发倍数",
            "description": "指数增长的上限倍数，最大并发数=基础并发数×倍数。建议2-8之间。",
            "default": 4
        },
        "absolute_concurrent_limit": {
            "type": "integer",
            "title": "绝对并发上限",
            "description": "无论如何计算，并发数都不会超过此值。建议5-20之间。",
            "default": 10
        }
    }
}
